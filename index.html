<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Aktörskarta Tröndelag & Jämtland Härjedalen</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin:0; font-family:sans-serif; display:flex; height:100vh; }
    #sidebar { width:30%; overflow-y:auto; padding:10px; background:#f5f5f5; }
    #map { flex:1; }
    h2 { margin:10px 0; }
    .category, .aktor { margin:5px 0; }
    select { width:100%; }
    .legend { background:white; padding:5px; line-height:1.4; }
    .legend-color-box { width:18px; height:18px; display:inline-block; margin-right:5px; vertical-align:middle; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>Kategorier</h2>
    <div id="category-list"></div>
    <h2>Filter på ort</h2>
    <select id="ort-filter"><option value="">Alla orter</option></select>
    <h2>Aktörer</h2>
    <div id="aktor-list"></div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // GeoJSON för Jämtland/Härjedalen och Trøndelag (förenklade)
    const geoJamtland = {
      "type":"Feature", "properties":{}, "geometry":{
        "type":"Polygon", "coordinates":[[
          [14.0,62.2],[14.0,64.0],[15.0,64.0],[15.0,62.2],[14.0,62.2]
        ]]
      }
    };
    const geoTrondelag = {
      "type":"Feature", "properties":{}, "geometry":{
        "type":"Polygon", "coordinates":[[
          [9.0,63.0],[9.0,64.5],[11.0,64.5],[11.0,63.0],[9.0,63.0]
        ]]
      }
    };

    // Data: kategori, namn, ort, coords
    const aktorer = [
      {kategori:"Näringslivsorganisationer - Jämtland Härjedalen",namn:"Samling Näringsliv",ort:"Östersund",coords:[63.1792,14.6357]},
      {kategori:"Offentliga aktörer - Jämtland Härjedalen",namn:"Polisen",ort:"Östersund",coords:[63.1792,14.6357]},
      {kategori:"Näringslivsorganisationer - Tröndelag",namn:"NHO Næringslivets Hovedorganisasjon",ort:"Trondheim",coords:[63.4305,10.3951]},
      {kategori:"Offentliga aktörer - Tröndelag",namn:"Statsforvalteren",ort:"Trondheim",coords:[63.4305,10.3951]},
      // Fyll på här med resten av aktörerna från din lista...
    ];

    const map = L.map('map').setView([63.5, 12.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:18, attribution:'© OpenStreetMap' }).addTo(map);

    // Lägg till gränspolygoner
    L.geoJSON(geoJamtland, {style:{color:'#0055A4',weight:3,fillColor:'#0055A4',fillOpacity:0.1}}).addTo(map);
    L.geoJSON(geoTrondelag, {style:{color:'#3C763D',weight:3,fillColor:'#3C763D',fillOpacity:0.1}}).addTo(map);

    // Legend
    const legend = L.control({position:'topright'});
    legend.onAdd = function(){
      const div = L.DomUtil.create('div','legend');
      div.innerHTML = '<div><span class="legend-color-box" style="background:#0055A4;"></span>Jämtland/Härjedalen</div>'
                    + '<div><span class="legend-color-box" style="background:#3C763D;"></span>Trøndelag</div>';
      return div;
    };
    legend.addTo(map);

    const categoryLayers = {};
    aktorer.forEach(a => {
      if(!categoryLayers[a.kategori]) categoryLayers[a.kategori] = L.layerGroup();
      const marker = L.marker(a.coords).bindPopup(`<b>${a.namn}</b><br>${a.ort}`);
      marker.addTo(categoryLayers[a.kategori]);
    });

    const catContainer = document.getElementById('category-list');
    Object.keys(categoryLayers).forEach(cat => {
      const div = document.createElement('div'); div.className='category';
      const cb = document.createElement('input'); cb.type='checkbox'; cb.id=cat;
      cb.addEventListener('change', updateDisplay);
      const lbl = document.createElement('label'); lbl.htmlFor=cat; lbl.innerText=cat;
      div.append(cb,lbl);
      catContainer.appendChild(div);
    });

    const ortFilter = document.getElementById('ort-filter');
    [...new Set(aktorer.map(a=>a.ort))].sort().forEach(o => {
      const opt = document.createElement('option'); opt.value=o; opt.innerText=o;
      ortFilter.appendChild(opt);
    });
    ortFilter.addEventListener('change',updateDisplay);

    const listDiv = document.getElementById('aktor-list');
    function updateDisplay(){
      Object.values(categoryLayers).forEach(l=>l.remove());
      listDiv.innerHTML='';

      const selectedCats = [...catContainer.querySelectorAll('input:checked')].map(cb=>cb.id);
      const selOrt = ortFilter.value;

      aktorer.forEach(a => {
        if(selectedCats.includes(a.kategori) && (!selOrt || a.ort===selOrt)) {
          const div = document.createElement('div'); div.className='aktor';
          div.innerText = `${a.namn} (${a.ort})`;
          listDiv.appendChild(div);
          categoryLayers[a.kategori].addTo(map);
        }
      });
    }
  </script>
</body>
</html>
